<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="MBRjun-Blog"><title>Typecho TTFB、加载速度优化教程 - MBRjun-Blog</title><meta name="author" content="MBRjun"><meta name="keywords" content="MBRjun,Linux,服务器,软路由,PVE,原神,maimai,JavaScript,Windows,Microsoft,git,Node.JS,"><link rel="icon" href="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MBRjun","sameAs":["https://github.com/MBRjun","https://twitter.com/MBRjun","mailto:neko@mbr.moe"],"image":"https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"},"articleBody":"很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。\n\n\n\n先贴一下我机器的配置：\n12345678910111213141516171819BASH             ..                    root@MBR-Server               .PLTJ.                  ---------------              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217     KKSSV&#x27; 4KKK LJ KKKL.&#x27;VSSKK        Host: CVM 3.0     KKV&#x27; 4KKKKK LJ KKKKAL &#x27;VKK        Kernel: 5.4.119-19-0009.1     V&#x27; &#x27; &#x27;VKKKK LJ KKKKV&#x27; &#x27; &#x27;V        Network: 1 Mbps     .4MA.&#x27; &#x27;VKK LJ KKV&#x27; &#x27;.4Mb.        Packages: 1169 (rpm)   . KKKKKA.&#x27; &#x27;V LJ V&#x27; &#x27;.4KKKKK .      Shell: bash 4.4.20 .4D KKKKKKKA.&#x27;&#x27; LJ &#x27;&#x27;.4KKKKKKK FA.    Terminal: /dev/pts/1&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz &#x27;VD KKKKKKKK&#x27;.. LJ ..&#x27;KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446   &#x27; VKKKKK&#x27;. .4 LJ K. .&#x27;KKKKKV &#x27;      Memory: 1262MiB / 1721MiB      &#x27;VK&#x27;. .4KK LJ KKA. .&#x27;KV&#x27;         SSD: 50GB     A. . .4KKKK LJ KKKKA. . .4     KKA. &#x27;KKKKK LJ KKKKK&#x27; .4KK     KKSSA. VKKK LJ KKKV .4SSKK              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;               &#x27;MKKM&#x27;                 &#x27;&#x27;\n\n低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右\n优化教程测试速度首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时顺便推荐一个更好用的网页测速工具：PageSpeed Insights\n测试完成速度可以开始按照下面的教程优化了（TIP：本站有目录功能）\nWebP 压缩WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。目前压缩有两种常见的方法：\nCDN 自动压缩部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图\n手动压缩如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器如果想要手动压缩，只需要前往 https://squoosh.app\nPHP 版本旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+\n数据库缓存网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis\nRedis 安装\n首先安装一个 Redis 6.2.6\n然后给你的 PHP 安装 Redis 插件\nTypecho 内安装 TpCache\n\nCDNCDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”\n宝塔缓存如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC\nOpCache脚本缓存器，直接安装即可\nTCP Fast Open该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 uname -r 检查 Linux 版本\n15.4.119-19-0009.1\n\n返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的开启方法如下：\n123#二选一：sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFOsysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许\n\nHTTP&#x2F;3开启 HTTP&#x2F;3 后可以有效提高握手效率，你需要编译 nginx-quic 来使用该功能目前最新的 HTTP&#x2F;3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）开启 HTTP&#x2F;3 后，你可以看到服务器发回的响应有一个 alt-svc 头? 在这里测试你的网站是否支持 HTTP&#x2F;3https://http3check.net/\nTCP BBR开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：https://blog.mbrjun.cn/archives/431\nMySQL 引擎Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM如果你升级到了 Release 1.2，那么请你使用 InnoDB\n降低压缩率动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms\n\ntitle: Typecho TTFB、加载速度优化教程date: 2022-04-15 15:35:00updated: 2022-04-28 00:39:56categories: 网络tags:- 网站- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。\n\n先贴一下我机器的配置：\n12345678910111213141516171819BASH             ..                    root@MBR-Server               .PLTJ.                  ---------------              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217     KKSSV&#x27; 4KKK LJ KKKL.&#x27;VSSKK        Host: CVM 3.0     KKV&#x27; 4KKKKK LJ KKKKAL &#x27;VKK        Kernel: 5.4.119-19-0009.1     V&#x27; &#x27; &#x27;VKKKK LJ KKKKV&#x27; &#x27; &#x27;V        Network: 1 Mbps     .4MA.&#x27; &#x27;VKK LJ KKV&#x27; &#x27;.4Mb.        Packages: 1169 (rpm)   . KKKKKA.&#x27; &#x27;V LJ V&#x27; &#x27;.4KKKKK .      Shell: bash 4.4.20 .4D KKKKKKKA.&#x27;&#x27; LJ &#x27;&#x27;.4KKKKKKK FA.    Terminal: /dev/pts/1&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz &#x27;VD KKKKKKKK&#x27;.. LJ ..&#x27;KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446   &#x27; VKKKKK&#x27;. .4 LJ K. .&#x27;KKKKKV &#x27;      Memory: 1262MiB / 1721MiB      &#x27;VK&#x27;. .4KK LJ KKA. .&#x27;KV&#x27;         SSD: 50GB     A. . .4KKKK LJ KKKKA. . .4     KKA. &#x27;KKKKK LJ KKKKK&#x27; .4KK     KKSSA. VKKK LJ KKKV .4SSKK              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;               &#x27;MKKM&#x27;                 &#x27;&#x27;\n\n低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右\n优化教程测试速度首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时顺便推荐一个更好用的网页测速工具：PageSpeed Insights\n测试完成速度可以开始按照下面的教程优化了（TIP：本站有目录功能）\nWebP 压缩WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。目前压缩有两种常见的方法：\nCDN 自动压缩部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图\n手动压缩如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器如果想要手动压缩，只需要前往 https://squoosh.app\nPHP 版本旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+\n数据库缓存网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis\nRedis 安装\n首先安装一个 Redis 6.2.6\n然后给你的 PHP 安装 Redis 插件\nTypecho 内安装 TpCache\n\nCDNCDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”\n宝塔缓存如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC\nOpCache脚本缓存器，直接安装即可\nTCP Fast Open该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 uname -r 检查 Linux 版本\n15.4.119-19-0009.1\n\n返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的开启方法如下：\n123#二选一：sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFOsysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许\n\nHTTP&#x2F;3开启 HTTP&#x2F;3 后可以有效提高握手效率，你需要编译 nginx-quic 来使用该功能目前最新的 HTTP&#x2F;3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）开启 HTTP&#x2F;3 后，你可以看到服务器发回的响应有一个 alt-svc 头? 在这里测试你的网站是否支持 HTTP&#x2F;3https://http3check.net/\nTCP BBR开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：https://blog.mbrjun.cn/archives/431\nMySQL 引擎Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM如果你升级到了 Release 1.2，那么请你使用 InnoDB\n降低压缩率动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms\n\ntitle: Typecho TTFB、加载速度优化教程date: 2022-04-15 15:35:00updated: 2022-04-28 00:39:56categories: Web（PHP&#x2F;ASP&#x2F;HTML）tags:- 网站- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。\n\n先贴一下我机器的配置：\n12345678910111213141516171819BASH             ..                    root@MBR-Server               .PLTJ.                  ---------------              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217     KKSSV&#x27; 4KKK LJ KKKL.&#x27;VSSKK        Host: CVM 3.0     KKV&#x27; 4KKKKK LJ KKKKAL &#x27;VKK        Kernel: 5.4.119-19-0009.1     V&#x27; &#x27; &#x27;VKKKK LJ KKKKV&#x27; &#x27; &#x27;V        Network: 1 Mbps     .4MA.&#x27; &#x27;VKK LJ KKV&#x27; &#x27;.4Mb.        Packages: 1169 (rpm)   . KKKKKA.&#x27; &#x27;V LJ V&#x27; &#x27;.4KKKKK .      Shell: bash 4.4.20 .4D KKKKKKKA.&#x27;&#x27; LJ &#x27;&#x27;.4KKKKKKK FA.    Terminal: /dev/pts/1&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz &#x27;VD KKKKKKKK&#x27;.. LJ ..&#x27;KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446   &#x27; VKKKKK&#x27;. .4 LJ K. .&#x27;KKKKKV &#x27;      Memory: 1262MiB / 1721MiB      &#x27;VK&#x27;. .4KK LJ KKA. .&#x27;KV&#x27;         SSD: 50GB     A. . .4KKKK LJ KKKKA. . .4     KKA. &#x27;KKKKK LJ KKKKK&#x27; .4KK     KKSSA. VKKK LJ KKKV .4SSKK              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;               &#x27;MKKM&#x27;                 &#x27;&#x27;\n\n低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右\n优化教程测试速度首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时顺便推荐一个更好用的网页测速工具：PageSpeed Insights\n测试完成速度可以开始按照下面的教程优化了（TIP：本站有目录功能）\nWebP 压缩WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。目前压缩有两种常见的方法：\nCDN 自动压缩部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图\n手动压缩如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器如果想要手动压缩，只需要前往 https://squoosh.app\nPHP 版本旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+\n数据库缓存网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis\nRedis 安装\n首先安装一个 Redis 6.2.6\n然后给你的 PHP 安装 Redis 插件\nTypecho 内安装 TpCache\n\nCDNCDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”\n宝塔缓存如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC\nOpCache脚本缓存器，直接安装即可\nTCP Fast Open该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 uname -r 检查 Linux 版本\n15.4.119-19-0009.1\n\n返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的开启方法如下：\n123#二选一：sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFOsysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许\n\nHTTP&#x2F;3开启 HTTP&#x2F;3 后可以有效提高握手效率，你需要编译 nginx-quic 来使用该功能目前最新的 HTTP&#x2F;3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）开启 HTTP&#x2F;3 后，你可以看到服务器发回的响应有一个 alt-svc 头? 在这里测试你的网站是否支持 HTTP&#x2F;3https://http3check.net/\nTCP BBR开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：https://blog.mbrjun.cn/archives/431\nMySQL 引擎Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM如果你升级到了 Release 1.2，那么请你使用 InnoDB\n降低压缩率动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms\n\ntitle: Typecho TTFB、加载速度优化教程date: 2022-04-15 15:35:00updated: 2022-04-28 00:39:56categories: UDP&#x2F;QUICtags:- 网站- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。\n\n先贴一下我机器的配置：\n12345678910111213141516171819BASH             ..                    root@MBR-Server               .PLTJ.                  ---------------              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217     KKSSV&#x27; 4KKK LJ KKKL.&#x27;VSSKK        Host: CVM 3.0     KKV&#x27; 4KKKKK LJ KKKKAL &#x27;VKK        Kernel: 5.4.119-19-0009.1     V&#x27; &#x27; &#x27;VKKKK LJ KKKKV&#x27; &#x27; &#x27;V        Network: 1 Mbps     .4MA.&#x27; &#x27;VKK LJ KKV&#x27; &#x27;.4Mb.        Packages: 1169 (rpm)   . KKKKKA.&#x27; &#x27;V LJ V&#x27; &#x27;.4KKKKK .      Shell: bash 4.4.20 .4D KKKKKKKA.&#x27;&#x27; LJ &#x27;&#x27;.4KKKKKKK FA.    Terminal: /dev/pts/1&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz &#x27;VD KKKKKKKK&#x27;.. LJ ..&#x27;KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446   &#x27; VKKKKK&#x27;. .4 LJ K. .&#x27;KKKKKV &#x27;      Memory: 1262MiB / 1721MiB      &#x27;VK&#x27;. .4KK LJ KKA. .&#x27;KV&#x27;         SSD: 50GB     A. . .4KKKK LJ KKKKA. . .4     KKA. &#x27;KKKKK LJ KKKKK&#x27; .4KK     KKSSA. VKKK LJ KKKV .4SSKK              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;               &#x27;MKKM&#x27;                 &#x27;&#x27;\n\n低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右\n优化教程测试速度首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时顺便推荐一个更好用的网页测速工具：PageSpeed Insights\n测试完成速度可以开始按照下面的教程优化了（TIP：本站有目录功能）\nWebP 压缩WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。目前压缩有两种常见的方法：\nCDN 自动压缩部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图\n手动压缩如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器如果想要手动压缩，只需要前往 https://squoosh.app\nPHP 版本旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+\n数据库缓存网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis\nRedis 安装\n首先安装一个 Redis 6.2.6\n然后给你的 PHP 安装 Redis 插件\nTypecho 内安装 TpCache\n\nCDNCDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”\n宝塔缓存如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC\nOpCache脚本缓存器，直接安装即可\nTCP Fast Open该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 uname -r 检查 Linux 版本\n15.4.119-19-0009.1\n\n返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的开启方法如下：\n123#二选一：sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFOsysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许\n\nHTTP&#x2F;3开启 HTTP&#x2F;3 后可以有效提高握手效率，你需要编译 nginx-quic 来使用该功能目前最新的 HTTP&#x2F;3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）开启 HTTP&#x2F;3 后，你可以看到服务器发回的响应有一个 alt-svc 头? 在这里测试你的网站是否支持 HTTP&#x2F;3https://http3check.net/\nTCP BBR开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：https://blog.mbrjun.cn/archives/431\nMySQL 引擎Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM如果你升级到了 Release 1.2，那么请你使用 InnoDB\n降低压缩率动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms\n","dateCreated":"2022-04-15T15:35:00+08:00","dateModified":"2022-04-28T00:39:56+08:00","datePublished":"2022-04-15T15:35:00+08:00","description":"很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。","headline":"Typecho TTFB、加载速度优化教程","image":["https://cos.mbrjun.cn/IMGS/2022/04/15/ls.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.mbrjun.cn/archives/432/"},"publisher":{"@type":"Organization","name":"MBRjun","sameAs":["https://github.com/MBRjun","https://twitter.com/MBRjun","mailto:neko@mbr.moe"],"image":"https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg","logo":{"@type":"ImageObject","url":"https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"}},"url":"https://www.mbrjun.cn/archives/432/","keywords":"网站, typecho, 优化, Mysql, Nginx, 建站, 博客, 加速, FTTB","thumbnailUrl":"https://cos.mbrjun.cn/IMGS/2022/04/15/ls.png"}</script><meta name="description" content="很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。"><meta property="og:type" content="blog"><meta property="og:title" content="Typecho TTFB、加载速度优化教程"><meta property="og:url" content="https://www.mbrjun.cn/archives/432/index.html"><meta property="og:site_name" content="MBRjun-Blog"><meta property="og:description" content="很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"><meta property="article:published_time" content="2022-04-15T07:35:00.000Z"><meta property="article:modified_time" content="2022-04-27T16:39:56.000Z"><meta property="article:author" content="MBRjun"><meta property="article:tag" content="网站"><meta property="article:tag" content="typecho"><meta property="article:tag" content="优化"><meta property="article:tag" content="Mysql"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="建站"><meta property="article:tag" content="博客"><meta property="article:tag" content="加速"><meta property="article:tag" content="FTTB"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><meta name="twitter:creator" content="@MBRjun"><meta property="og:image" content="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2022/04/15/ls.png"><meta class="swiftype" name="image" data-type="enum" content="https://cos.mbrjun.cn/IMGS/2022/04/15/ls.png"><!--STYLES--><link rel="stylesheet" href="/assets/css/style.min.css?v=fb88b9e2ff0a8ff6fcd9f78fb07649875fac0302"><!--STYLES END--><!--SCRIPTS--><script async="" defer="" src="/assets/js/script.min.js?v=fb88b9e2ff0a8ff6fcd9f78fb07649875fac0302"></script><!--SCRIPTS END--><!--PRELOAD--><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="//github.githubassets.com"><link rel="dns-prefetch" href="//avatars.githubusercontent.com"><link rel="preconnect" href="https://cos.mbrjun.cn"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/GoogleSansDisplay-BR.woff2"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/GoogleSansDisplay-LR.woff2"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/fa-solid-900.woff2"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/fa-brands-400.woff2"><!--PRELOAD END--><script>"use strict";var scripts=["/assets/js/webp-polyfill.min.js?v=2.0.1"];function parallelLoadScripts(e,t){"object"!=typeof e&&(e=[e]);for(var n=document.getElementsByTagName("head")[0]||document.documentElement,o=[],l=0,i=0;i<e.length;i++)o[i]=document.createElement("script"),o[i].setAttribute("type","text/javascript"),o[i].onload=o[i].onreadystatechange=function(){l++,this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this),l===e.length&&"function"==typeof t&&t()},o[i].setAttribute("src",e[i]),n.appendChild(o[i])}"ActiveXObject"in window&&parallelLoadScripts(scripts,function(){console.log("[hexo-webp-polyfill] polyfilling document"),(new webpHero.WebpMachine).polyfillDocument()});</script></head><body><div id="blog"><!-- Define author's picture --><header id="header" data-behavior="2"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">MBRjun-Blog</a></div><a class="header-right-picture" href="/about" aria-label="打开链接: /about"><img class="header-picture" src="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg" alt="作者的图片"></a></header><!-- Define author's picture --><nav id="sidebar" data-behavior="2"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">MBRjun</h4><h5 class="sidebar-profile-bio"><p>我们生活在大地上，但我们的梦想超越天空</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/links" rel="noopener" title="友情链接"><i class="sidebar-button-icon fa fa-link" aria-hidden="true"></i> <span class="sidebar-button-desc">友情链接</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://www.travellings.cn/go.html" target="_blank" rel="noopener" title="开往"><i class="sidebar-button-icon fa fa-paper-plane" aria-hidden="true"></i> <span class="sidebar-button-desc">开往</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/MBRjun" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://twitter.com/MBRjun" target="_blank" rel="noopener" title="Twitter"><i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i> <span class="sidebar-button-desc">Twitter</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:neko@mbr.moe" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml" rel="noopener" title="RSS"><i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="2" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-left"><h1 class="post-title">Typecho TTFB、加载速度优化教程</h1><div class="post-meta"><time datetime="2022-04-15T15:35:00+08:00">2022 年 4 月 15 日 </time><span>发布在 </span><a class="category-link" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></div></div><div class="post-content markdown"><div class="main-content-wrap"><p>很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。</p><span id="more"></span><hr><p>先贴一下我机器的配置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">BASH             ..                    root@MBR-Server<br>               .PLTJ.                  ---------------<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217<br>     KKSSV' 4KKK LJ KKKL.'VSSKK        Host: CVM 3.0<br>     KKV' 4KKKKK LJ KKKKAL 'VKK        Kernel: 5.4.119-19-0009.1<br>     V' ' 'VKKKK LJ KKKKV' ' 'V        Network: 1 Mbps<br>     .4MA.' 'VKK LJ KKV' '.4Mb.        Packages: 1169 (rpm)<br>   . KKKKKA.' 'V LJ V' '.4KKKKK .      Shell: bash 4.4.20<br> .4D KKKKKKKA.'' LJ ''.4KKKKKKK FA.    Terminal: /dev/pts/1<br>&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz<br> 'VD KKKKKKKK'.. LJ ..'KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446<br>   ' VKKKKK'. .4 LJ K. .'KKKKKV '      Memory: 1262MiB / 1721MiB<br>      'VK'. .4KK LJ KKA. .'KV'         SSD: 50GB<br>     A. . .4KKKK LJ KKKKA. . .4<br>     KKA. 'KKKKK LJ KKKKK' .4KK<br>     KKSSA. VKKK LJ KKKV .4SSKK<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;<br>               'MKKM'<br>                 ''<br></code></pre></td></tr></tbody></table></figure><p>低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右</p><h2 id="优化教程"><a href="#优化教程" class="headerlink" title="优化教程"></a>优化教程</h2><h3 id="测试速度"><a href="#测试速度" class="headerlink" title="测试速度"></a>测试速度</h3><p>首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><br>顺便推荐一个更好用的网页测速工具：<a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"></p><p>测试完成速度可以开始按照下面的教程优化了<br>（TIP：本站有目录功能）</p><h3 id="WebP-压缩"><a href="#WebP-压缩" class="headerlink" title="WebP 压缩"></a>WebP 压缩</h3><p>WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升<br>WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。<br>目前压缩有两种常见的方法：</p><h4 id="CDN-自动压缩"><a href="#CDN-自动压缩" class="headerlink" title="CDN 自动压缩"></a>CDN 自动压缩</h4><p>部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"></p><h4 id="手动压缩"><a href="#手动压缩" class="headerlink" title="手动压缩"></a>手动压缩</h4><p>如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器<br>如果想要手动压缩，只需要前往 <a target="_blank" rel="noopener" href="https://squoosh.app/">https://squoosh.app</a></p><h3 id="PHP-版本"><a href="#PHP-版本" class="headerlink" title="PHP 版本"></a>PHP 版本</h3><p>旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x<br>注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+</p><h3 id="数据库缓存"><a href="#数据库缓存" class="headerlink" title="数据库缓存"></a>数据库缓存</h3><p>网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）<br>MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis</p><h4 id="Redis-安装"><a href="#Redis-安装" class="headerlink" title="Redis 安装"></a>Redis 安装</h4><ol><li>首先安装一个 Redis 6.2.6</li><li>然后给你的 PHP 安装 Redis 插件</li><li>Typecho 内安装 TpCache</li></ol><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>CDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”</p><h3 id="宝塔缓存"><a href="#宝塔缓存" class="headerlink" title="宝塔缓存"></a>宝塔缓存</h3><p>如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"></p><h3 id="OpCache"><a href="#OpCache" class="headerlink" title="OpCache"></a>OpCache</h3><p>脚本缓存器，直接安装即可</p><h3 id="TCP-Fast-Open"><a href="#TCP-Fast-Open" class="headerlink" title="TCP Fast Open"></a>TCP Fast Open</h3><p>该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 <code>uname -r</code> 检查 Linux 版本</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">5.4.119-19-0009.1<br></code></pre></td></tr></tbody></table></figure><p>返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的<br>开启方法如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#二选一：<br>sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFO<br>sysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许<br></code></pre></td></tr></tbody></table></figure><h3 id="HTTP-3"><a href="#HTTP-3" class="headerlink" title="HTTP/3"></a>HTTP/3</h3><p>开启 HTTP/3 后可以有效提高握手效率，你需要编译 <code>nginx-quic</code> 来使用该功能<br>目前最新的 HTTP/3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）<br>开启 HTTP/3 后，你可以看到服务器发回的响应有一个 <code>alt-svc</code> 头<br>? 在这里测试你的网站是否支持 HTTP/3<br><a target="_blank" rel="noopener" href="https://http3check.net/">https://http3check.net/</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"></p><h3 id="TCP-BBR"><a href="#TCP-BBR" class="headerlink" title="TCP BBR"></a>TCP BBR</h3><p>开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：<br><a target="_blank" rel="noopener" href="https://blog.mbrjun.cn/archives/431">https://blog.mbrjun.cn/archives/431</a></p><h3 id="MySQL-引擎"><a href="#MySQL-引擎" class="headerlink" title="MySQL 引擎"></a>MySQL 引擎</h3><p>Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM<br><strong>如果你升级到了 Release 1.2，那么请你使用 InnoDB</strong></p><h3 id="降低压缩率"><a href="#降低压缩率" class="headerlink" title="降低压缩率"></a>降低压缩率</h3><p>动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩<br>GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms</p><hr><h2 id="title-Typecho-TTFB、加载速度优化教程date-2022-04-15-15-35-00updated-2022-04-28-00-39-56categories-网络tags-网站-typecho-优化-Mysql-Nginx-建站-博客-加速-FTTB"><a href="#title-Typecho-TTFB、加载速度优化教程date-2022-04-15-15-35-00updated-2022-04-28-00-39-56categories-网络tags-网站-typecho-优化-Mysql-Nginx-建站-博客-加速-FTTB" class="headerlink" title="title: Typecho TTFB、加载速度优化教程date: 2022-04-15 15:35:00updated: 2022-04-28 00:39:56categories: 网络tags:- 网站- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB"></a>title: Typecho TTFB、加载速度优化教程<br>date: 2022-04-15 15:35:00<br>updated: 2022-04-28 00:39:56<br>categories: 网络<br>tags:<br>- 网站<br>- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB</h2><p>很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。</p><hr><p>先贴一下我机器的配置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">BASH             ..                    root@MBR-Server<br>               .PLTJ.                  ---------------<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217<br>     KKSSV' 4KKK LJ KKKL.'VSSKK        Host: CVM 3.0<br>     KKV' 4KKKKK LJ KKKKAL 'VKK        Kernel: 5.4.119-19-0009.1<br>     V' ' 'VKKKK LJ KKKKV' ' 'V        Network: 1 Mbps<br>     .4MA.' 'VKK LJ KKV' '.4Mb.        Packages: 1169 (rpm)<br>   . KKKKKA.' 'V LJ V' '.4KKKKK .      Shell: bash 4.4.20<br> .4D KKKKKKKA.'' LJ ''.4KKKKKKK FA.    Terminal: /dev/pts/1<br>&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz<br> 'VD KKKKKKKK'.. LJ ..'KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446<br>   ' VKKKKK'. .4 LJ K. .'KKKKKV '      Memory: 1262MiB / 1721MiB<br>      'VK'. .4KK LJ KKA. .'KV'         SSD: 50GB<br>     A. . .4KKKK LJ KKKKA. . .4<br>     KKA. 'KKKKK LJ KKKKK' .4KK<br>     KKSSA. VKKK LJ KKKV .4SSKK<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;<br>               'MKKM'<br>                 ''<br></code></pre></td></tr></tbody></table></figure><p>低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右</p><h2 id="优化教程-1"><a href="#优化教程-1" class="headerlink" title="优化教程"></a>优化教程</h2><h3 id="测试速度-1"><a href="#测试速度-1" class="headerlink" title="测试速度"></a>测试速度</h3><p>首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><br>顺便推荐一个更好用的网页测速工具：<a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"></p><p>测试完成速度可以开始按照下面的教程优化了<br>（TIP：本站有目录功能）</p><h3 id="WebP-压缩-1"><a href="#WebP-压缩-1" class="headerlink" title="WebP 压缩"></a>WebP 压缩</h3><p>WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升<br>WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。<br>目前压缩有两种常见的方法：</p><h4 id="CDN-自动压缩-1"><a href="#CDN-自动压缩-1" class="headerlink" title="CDN 自动压缩"></a>CDN 自动压缩</h4><p>部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"></p><h4 id="手动压缩-1"><a href="#手动压缩-1" class="headerlink" title="手动压缩"></a>手动压缩</h4><p>如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器<br>如果想要手动压缩，只需要前往 <a target="_blank" rel="noopener" href="https://squoosh.app/">https://squoosh.app</a></p><h3 id="PHP-版本-1"><a href="#PHP-版本-1" class="headerlink" title="PHP 版本"></a>PHP 版本</h3><p>旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x<br>注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+</p><h3 id="数据库缓存-1"><a href="#数据库缓存-1" class="headerlink" title="数据库缓存"></a>数据库缓存</h3><p>网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）<br>MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis</p><h4 id="Redis-安装-1"><a href="#Redis-安装-1" class="headerlink" title="Redis 安装"></a>Redis 安装</h4><ol><li>首先安装一个 Redis 6.2.6</li><li>然后给你的 PHP 安装 Redis 插件</li><li>Typecho 内安装 TpCache</li></ol><h3 id="CDN-1"><a href="#CDN-1" class="headerlink" title="CDN"></a>CDN</h3><p>CDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”</p><h3 id="宝塔缓存-1"><a href="#宝塔缓存-1" class="headerlink" title="宝塔缓存"></a>宝塔缓存</h3><p>如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"></p><h3 id="OpCache-1"><a href="#OpCache-1" class="headerlink" title="OpCache"></a>OpCache</h3><p>脚本缓存器，直接安装即可</p><h3 id="TCP-Fast-Open-1"><a href="#TCP-Fast-Open-1" class="headerlink" title="TCP Fast Open"></a>TCP Fast Open</h3><p>该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 <code>uname -r</code> 检查 Linux 版本</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">5.4.119-19-0009.1<br></code></pre></td></tr></tbody></table></figure><p>返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的<br>开启方法如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#二选一：<br>sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFO<br>sysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许<br></code></pre></td></tr></tbody></table></figure><h3 id="HTTP-3-1"><a href="#HTTP-3-1" class="headerlink" title="HTTP/3"></a>HTTP/3</h3><p>开启 HTTP/3 后可以有效提高握手效率，你需要编译 <code>nginx-quic</code> 来使用该功能<br>目前最新的 HTTP/3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）<br>开启 HTTP/3 后，你可以看到服务器发回的响应有一个 <code>alt-svc</code> 头<br>? 在这里测试你的网站是否支持 HTTP/3<br><a target="_blank" rel="noopener" href="https://http3check.net/">https://http3check.net/</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"></p><h3 id="TCP-BBR-1"><a href="#TCP-BBR-1" class="headerlink" title="TCP BBR"></a>TCP BBR</h3><p>开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：<br><a target="_blank" rel="noopener" href="https://blog.mbrjun.cn/archives/431">https://blog.mbrjun.cn/archives/431</a></p><h3 id="MySQL-引擎-1"><a href="#MySQL-引擎-1" class="headerlink" title="MySQL 引擎"></a>MySQL 引擎</h3><p>Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM<br><strong>如果你升级到了 Release 1.2，那么请你使用 InnoDB</strong></p><h3 id="降低压缩率-1"><a href="#降低压缩率-1" class="headerlink" title="降低压缩率"></a>降低压缩率</h3><p>动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩<br>GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms</p><hr><h2 id="title-Typecho-TTFB、加载速度优化教程date-2022-04-15-15-35-00updated-2022-04-28-00-39-56categories-Web（PHP-ASP-HTML）tags-网站-typecho-优化-Mysql-Nginx-建站-博客-加速-FTTB"><a href="#title-Typecho-TTFB、加载速度优化教程date-2022-04-15-15-35-00updated-2022-04-28-00-39-56categories-Web（PHP-ASP-HTML）tags-网站-typecho-优化-Mysql-Nginx-建站-博客-加速-FTTB" class="headerlink" title="title: Typecho TTFB、加载速度优化教程date: 2022-04-15 15:35:00updated: 2022-04-28 00:39:56categories: Web（PHP/ASP/HTML）tags:- 网站- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB"></a>title: Typecho TTFB、加载速度优化教程<br>date: 2022-04-15 15:35:00<br>updated: 2022-04-28 00:39:56<br>categories: Web（PHP/ASP/HTML）<br>tags:<br>- 网站<br>- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB</h2><p>很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。</p><hr><p>先贴一下我机器的配置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">BASH             ..                    root@MBR-Server<br>               .PLTJ.                  ---------------<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217<br>     KKSSV' 4KKK LJ KKKL.'VSSKK        Host: CVM 3.0<br>     KKV' 4KKKKK LJ KKKKAL 'VKK        Kernel: 5.4.119-19-0009.1<br>     V' ' 'VKKKK LJ KKKKV' ' 'V        Network: 1 Mbps<br>     .4MA.' 'VKK LJ KKV' '.4Mb.        Packages: 1169 (rpm)<br>   . KKKKKA.' 'V LJ V' '.4KKKKK .      Shell: bash 4.4.20<br> .4D KKKKKKKA.'' LJ ''.4KKKKKKK FA.    Terminal: /dev/pts/1<br>&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz<br> 'VD KKKKKKKK'.. LJ ..'KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446<br>   ' VKKKKK'. .4 LJ K. .'KKKKKV '      Memory: 1262MiB / 1721MiB<br>      'VK'. .4KK LJ KKA. .'KV'         SSD: 50GB<br>     A. . .4KKKK LJ KKKKA. . .4<br>     KKA. 'KKKKK LJ KKKKK' .4KK<br>     KKSSA. VKKK LJ KKKV .4SSKK<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;<br>               'MKKM'<br>                 ''<br></code></pre></td></tr></tbody></table></figure><p>低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右</p><h2 id="优化教程-2"><a href="#优化教程-2" class="headerlink" title="优化教程"></a>优化教程</h2><h3 id="测试速度-2"><a href="#测试速度-2" class="headerlink" title="测试速度"></a>测试速度</h3><p>首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><br>顺便推荐一个更好用的网页测速工具：<a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"></p><p>测试完成速度可以开始按照下面的教程优化了<br>（TIP：本站有目录功能）</p><h3 id="WebP-压缩-2"><a href="#WebP-压缩-2" class="headerlink" title="WebP 压缩"></a>WebP 压缩</h3><p>WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升<br>WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。<br>目前压缩有两种常见的方法：</p><h4 id="CDN-自动压缩-2"><a href="#CDN-自动压缩-2" class="headerlink" title="CDN 自动压缩"></a>CDN 自动压缩</h4><p>部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"></p><h4 id="手动压缩-2"><a href="#手动压缩-2" class="headerlink" title="手动压缩"></a>手动压缩</h4><p>如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器<br>如果想要手动压缩，只需要前往 <a target="_blank" rel="noopener" href="https://squoosh.app/">https://squoosh.app</a></p><h3 id="PHP-版本-2"><a href="#PHP-版本-2" class="headerlink" title="PHP 版本"></a>PHP 版本</h3><p>旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x<br>注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+</p><h3 id="数据库缓存-2"><a href="#数据库缓存-2" class="headerlink" title="数据库缓存"></a>数据库缓存</h3><p>网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）<br>MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis</p><h4 id="Redis-安装-2"><a href="#Redis-安装-2" class="headerlink" title="Redis 安装"></a>Redis 安装</h4><ol><li>首先安装一个 Redis 6.2.6</li><li>然后给你的 PHP 安装 Redis 插件</li><li>Typecho 内安装 TpCache</li></ol><h3 id="CDN-2"><a href="#CDN-2" class="headerlink" title="CDN"></a>CDN</h3><p>CDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”</p><h3 id="宝塔缓存-2"><a href="#宝塔缓存-2" class="headerlink" title="宝塔缓存"></a>宝塔缓存</h3><p>如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"></p><h3 id="OpCache-2"><a href="#OpCache-2" class="headerlink" title="OpCache"></a>OpCache</h3><p>脚本缓存器，直接安装即可</p><h3 id="TCP-Fast-Open-2"><a href="#TCP-Fast-Open-2" class="headerlink" title="TCP Fast Open"></a>TCP Fast Open</h3><p>该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 <code>uname -r</code> 检查 Linux 版本</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">5.4.119-19-0009.1<br></code></pre></td></tr></tbody></table></figure><p>返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的<br>开启方法如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#二选一：<br>sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFO<br>sysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许<br></code></pre></td></tr></tbody></table></figure><h3 id="HTTP-3-2"><a href="#HTTP-3-2" class="headerlink" title="HTTP/3"></a>HTTP/3</h3><p>开启 HTTP/3 后可以有效提高握手效率，你需要编译 <code>nginx-quic</code> 来使用该功能<br>目前最新的 HTTP/3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）<br>开启 HTTP/3 后，你可以看到服务器发回的响应有一个 <code>alt-svc</code> 头<br>? 在这里测试你的网站是否支持 HTTP/3<br><a target="_blank" rel="noopener" href="https://http3check.net/">https://http3check.net/</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"></p><h3 id="TCP-BBR-2"><a href="#TCP-BBR-2" class="headerlink" title="TCP BBR"></a>TCP BBR</h3><p>开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：<br><a target="_blank" rel="noopener" href="https://blog.mbrjun.cn/archives/431">https://blog.mbrjun.cn/archives/431</a></p><h3 id="MySQL-引擎-2"><a href="#MySQL-引擎-2" class="headerlink" title="MySQL 引擎"></a>MySQL 引擎</h3><p>Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM<br><strong>如果你升级到了 Release 1.2，那么请你使用 InnoDB</strong></p><h3 id="降低压缩率-2"><a href="#降低压缩率-2" class="headerlink" title="降低压缩率"></a>降低压缩率</h3><p>动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩<br>GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms</p><hr><h2 id="title-Typecho-TTFB、加载速度优化教程date-2022-04-15-15-35-00updated-2022-04-28-00-39-56categories-UDP-QUICtags-网站-typecho-优化-Mysql-Nginx-建站-博客-加速-FTTB"><a href="#title-Typecho-TTFB、加载速度优化教程date-2022-04-15-15-35-00updated-2022-04-28-00-39-56categories-UDP-QUICtags-网站-typecho-优化-Mysql-Nginx-建站-博客-加速-FTTB" class="headerlink" title="title: Typecho TTFB、加载速度优化教程date: 2022-04-15 15:35:00updated: 2022-04-28 00:39:56categories: UDP/QUICtags:- 网站- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB"></a>title: Typecho TTFB、加载速度优化教程<br>date: 2022-04-15 15:35:00<br>updated: 2022-04-28 00:39:56<br>categories: UDP/QUIC<br>tags:<br>- 网站<br>- typecho,优化,Mysql,Nginx,建站,博客,加速,FTTB</h2><p>很多人搭建 Typecho 之后都会觉得自己的网站有些慢，想要优化下打开速度，碰巧最近站长也在做优化，所以写一篇优化教程。</p><hr><p>先贴一下我机器的配置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">BASH             ..                    root@MBR-Server<br>               .PLTJ.                  ---------------<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;                 OS: Tencent OS Server 3.1 20220217<br>     KKSSV' 4KKK LJ KKKL.'VSSKK        Host: CVM 3.0<br>     KKV' 4KKKKK LJ KKKKAL 'VKK        Kernel: 5.4.119-19-0009.1<br>     V' ' 'VKKKK LJ KKKKV' ' 'V        Network: 1 Mbps<br>     .4MA.' 'VKK LJ KKV' '.4Mb.        Packages: 1169 (rpm)<br>   . KKKKKA.' 'V LJ V' '.4KKKKK .      Shell: bash 4.4.20<br> .4D KKKKKKKA.'' LJ ''.4KKKKKKK FA.    Terminal: /dev/pts/1<br>&lt;QDD ++++++++++++  ++++++++++++ GFD&gt;   CPU: AMD EPYC 7K62 (2) @ 2.595GHz<br> 'VD KKKKKKKK'.. LJ ..'KKKKKKKK FV     GPU: 00:02.0 Cirrus Logic GD 5446<br>   ' VKKKKK'. .4 LJ K. .'KKKKKV '      Memory: 1262MiB / 1721MiB<br>      'VK'. .4KK LJ KKA. .'KV'         SSD: 50GB<br>     A. . .4KKKK LJ KKKKA. . .4<br>     KKA. 'KKKKK LJ KKKKK' .4KK<br>     KKSSA. VKKK LJ KKKV .4SSKK<br>              &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;<br>               'MKKM'<br>                 ''<br></code></pre></td></tr></tbody></table></figure><p>低配置的机子做好了优化速度也能很快，本站国内的平均打开速度为 1.0s，如果不做任何优化，那么本站首页的速度可能有 4s 左右</p><h2 id="优化教程-3"><a href="#优化教程-3" class="headerlink" title="优化教程"></a>优化教程</h2><h3 id="测试速度-3"><a href="#测试速度-3" class="headerlink" title="测试速度"></a>测试速度</h3><p>首先先测试一下当前的网页速度，按 F12 打开调试控制台，选择 网络，勾选持久日志和禁用缓存，清除 Service Worker，清理日志，刷新，调试控制台下面就会显示页面加载的耗时<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/jv.png"><br>顺便推荐一个更好用的网页测速工具：<a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/li.png"></p><p>测试完成速度可以开始按照下面的教程优化了<br>（TIP：本站有目录功能）</p><h3 id="WebP-压缩-3"><a href="#WebP-压缩-3" class="headerlink" title="WebP 压缩"></a>WebP 压缩</h3><p>WebP 是一个高压缩比的图片格式，支持无损和有损压缩，也支持透明图层，如果你网站的图片是 png 格式提供的，压缩为 WebP 通常会有很大的提升<br>WebP 图片的体积一般只有同等分辨率下 png 图片体积的十分之一。<br>目前压缩有两种常见的方法：</p><h4 id="CDN-自动压缩-3"><a href="#CDN-自动压缩-3" class="headerlink" title="CDN 自动压缩"></a>CDN 自动压缩</h4><p>部分 CDN 可以自动给图片进行 WebP 压缩，如果客户端支持 WebP，则使用 WebP，否则提供原图<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/nq.png"></p><h4 id="手动压缩-3"><a href="#手动压缩-3" class="headerlink" title="手动压缩"></a>手动压缩</h4><p>如果你的 CDN 不支持自动压缩，你也可以手动压缩，但是手动压缩会有一个问题，就是不支持 IE 浏览器<br>如果想要手动压缩，只需要前往 <a target="_blank" rel="noopener" href="https://squoosh.app/">https://squoosh.app</a></p><h3 id="PHP-版本-3"><a href="#PHP-版本-3" class="headerlink" title="PHP 版本"></a>PHP 版本</h3><p>旧版本（5.x）的 PHP 运行 Typecho 会很慢，强烈建议更新到 7.x 或者 8.x<br>注：Typecho 近期推出了 1.2 版本，距离上次更新有五年之久，1.1 版本不兼容 PHP 7.4+</p><h3 id="数据库缓存-3"><a href="#数据库缓存-3" class="headerlink" title="数据库缓存"></a>数据库缓存</h3><p>网站加载时间（TTFB）长的一大原因是查询数据库耗时太长，采用缓存可以有效加速（用户打开网页直接使用缓存，不再查询数据库）<br>MySQL 8.0 弃用了查询缓存，所以我们需要选择一个其他的高性能缓存器，本站的数据库缓存采用了 Redis</p><h4 id="Redis-安装-3"><a href="#Redis-安装-3" class="headerlink" title="Redis 安装"></a>Redis 安装</h4><ol><li>首先安装一个 Redis 6.2.6</li><li>然后给你的 PHP 安装 Redis 插件</li><li>Typecho 内安装 TpCache</li></ol><h3 id="CDN-3"><a href="#CDN-3" class="headerlink" title="CDN"></a>CDN</h3><p>CDN（内容分发网络）可以有效加速网页静态资源，并隐藏源站 IP，如果你使用 CDN，建议把所有动态页面设置为“不缓存”，所有静态资源都设置为“365 天”</p><h3 id="宝塔缓存-3"><a href="#宝塔缓存-3" class="headerlink" title="宝塔缓存"></a>宝塔缓存</h3><p>如果你用宝塔可以整一个，效果是挺好的，免费版每日 50000 次，破解版无限制，50000 次对普通个人肯定够了，除非遇上 CC<br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/vg.png"></p><h3 id="OpCache-3"><a href="#OpCache-3" class="headerlink" title="OpCache"></a>OpCache</h3><p>脚本缓存器，直接安装即可</p><h3 id="TCP-Fast-Open-3"><a href="#TCP-Fast-Open-3" class="headerlink" title="TCP Fast Open"></a>TCP Fast Open</h3><p>该功能要求 Linux 3.7 以上，有的发行版使用老内核无法开启，使用 <code>uname -r</code> 检查 Linux 版本</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">5.4.119-19-0009.1<br></code></pre></td></tr></tbody></table></figure><p>返回值大于 3.7 即可，目前已知 CentOS 7 是不支持该功能的<br>开启方法如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#二选一：<br>sysctl -w net.ipv4.tcp_fastoepn=3 #上传下载都允许 TFO<br>sysctl -w net.ipv4.tcp_fastoepn=2 #服务器模式，仅上传允许<br></code></pre></td></tr></tbody></table></figure><h3 id="HTTP-3-3"><a href="#HTTP-3-3" class="headerlink" title="HTTP/3"></a>HTTP/3</h3><p>开启 HTTP/3 后可以有效提高握手效率，你需要编译 <code>nginx-quic</code> 来使用该功能<br>目前最新的 HTTP/3 版本有：h3（正式版）、h3-29（IETF）、h3-Q050（Google）<br>开启 HTTP/3 后，你可以看到服务器发回的响应有一个 <code>alt-svc</code> 头<br>? 在这里测试你的网站是否支持 HTTP/3<br><a target="_blank" rel="noopener" href="https://http3check.net/">https://http3check.net/</a><br><img src="https://cos.mbrjun.cn/IMGS/2022/04/15/xi.png"></p><h3 id="TCP-BBR-3"><a href="#TCP-BBR-3" class="headerlink" title="TCP BBR"></a>TCP BBR</h3><p>开启 TCP BBR 可有效提高 TCP 连接性能，见此文章：<br><a target="_blank" rel="noopener" href="https://blog.mbrjun.cn/archives/431">https://blog.mbrjun.cn/archives/431</a></p><h3 id="MySQL-引擎-3"><a href="#MySQL-引擎-3" class="headerlink" title="MySQL 引擎"></a>MySQL 引擎</h3><p>Typecho 旧版本使用 MySQL 更适合 MyISAM 引擎（默认就是 MyISAM），如果你设置了 Innodb，请改回 MyISAM<br><strong>如果你升级到了 Release 1.2，那么请你使用 InnoDB</strong></p><h3 id="降低压缩率-3"><a href="#降低压缩率-3" class="headerlink" title="降低压缩率"></a>降低压缩率</h3><p>动态文档压缩要消耗很长时间，请减小动态文档的压缩率，或者直接关闭压缩<br>GZip 压缩率设置为 9，TTFB 大约 500ms，设置为 4 大约 300ms，设置为 1 大约 200ms</p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/FTTB/" rel="tag">FTTB</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Mysql/" rel="tag">Mysql</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Nginx/" rel="tag">Nginx</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/typecho/" rel="tag">typecho</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E4%BC%98%E5%8C%96/" rel="tag">优化</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E5%8A%A0%E9%80%9F/" rel="tag">加速</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">博客</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E5%BB%BA%E7%AB%99/" rel="tag">建站</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E7%BD%91%E7%AB%99/" rel="tag">网站</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/434/" data-tooltip="白嫖 IBM LinuxOne VPS" aria-label="上一篇: 白嫖 IBM LinuxOne VPS"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/431/" data-tooltip="Linux 开启 TCP BBR" aria-label="下一篇: Linux 开启 TCP BBR"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.mbrjun.cn/archives/432/" title="分享到 Twitter" aria-label="分享到 Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://www.mbrjun.cn/archives/432/" title="分享到 Weibo" aria-label="分享到 Weibo"><i class="fab fa-weibo" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.mbrjun.cn/archives/432/&amp;title=Typecho TTFB、加载速度优化教程" title="分享到 QQ" aria-label="分享到 QQ"><i class="fab fa-qq" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.mbrjun.cn/archives/432/" title="分享到 Qzone" aria-label="分享到 Qzone"><i class="fa fa-star" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div><script src="https://giscus.mbrjun.cn/client.js" data-repo="MBRjun/MBRjun-Blog" data-repo-id="R_kgDOIbI33Q" data-category="Blog" data-category-id="DIC_kwDOIbI33c4CTUTq" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light_tritanopia" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async=""></script></div></article><footer id="footer" class="main-content-wrap"><span class="copyrights"><a target="_blank" rel="noopener" href="https://github.com/MBRjun/MBRjun-Blog">GitHub 源代码</a> - <a target="_blank" rel="noopener" href="https://github.com/MBRjun/MBRjun-Blog/blob/main/LICENSE">LICENSE(CC BY-SA 3)</a><br></span><span class="text-small"><a target="_blank" href="https://beian.miit.gov.cn" rel="nofollow noopener">闽ICP备2024060656号-1</a> - <a target="_blank" href="http://www.beian.gov.cn" rel="nofollow noopener">津公网安备12010102001086号</a><br></span><span class="copyrights">Copyrights © 2024 MBRjun. All Rights Reserved.</span></footer><script async="" defer="" data-website-id="d1e9e8b4-ed73-416a-b8e7-ae518e698da6" src="https://delightful.mbrjun.cn/delightful.js?v=2.2.0-1"></script></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="2"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/434/" data-tooltip="白嫖 IBM LinuxOne VPS" aria-label="上一篇: 白嫖 IBM LinuxOne VPS"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/431/" data-tooltip="Linux 开启 TCP BBR" aria-label="下一篇: Linux 开启 TCP BBR"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.mbrjun.cn/archives/432/" title="分享到 Twitter" aria-label="分享到 Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://www.mbrjun.cn/archives/432/" title="分享到 Weibo" aria-label="分享到 Weibo"><i class="fab fa-weibo" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.mbrjun.cn/archives/432/&amp;title=Typecho TTFB、加载速度优化教程" title="分享到 QQ" aria-label="分享到 QQ"><i class="fab fa-qq" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.mbrjun.cn/archives/432/" title="分享到 Qzone" aria-label="分享到 Qzone"><i class="fa fa-star" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div><div id="share-options-bar" class="share-options-bar" data-behavior="2"><i id="btn-close-shareoptions" class="fa fa-times"></i><ul class="share-options"><li class="share-option"><a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://www.mbrjun.cn/archives/432/" aria-label="分享到 Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://www.mbrjun.cn/archives/432/" aria-label="分享到 Weibo"><i class="fab fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.mbrjun.cn/archives/432/&amp;title=Typecho TTFB、加载速度优化教程" aria-label="分享到 QQ"><i class="fab fa-qq" aria-hidden="true"></i><span>分享到 QQ</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.mbrjun.cn/archives/432/" aria-label="分享到 Qzone"><i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span></a></li></ul></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg" alt="作者的图片"><h4 id="about-card-name">MBRjun</h4><div id="about-card-bio"><p>我们生活在大地上，但我们的梦想超越天空</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>学生</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>地球</div></div></div><div id="cover" style="background-image:url('https://cos.mbrjun.cn/IMGS/2023/03/23/4419f34e-9353-4b44-a6dd-ebb1db958fc5.webp');"></div><!-- 
█▀▄▀█ █▄▄ █▀█ ░░█ █░█ █▄░█ ▄▄ █▄▄ █░░ █▀█ █▀▀
█░▀░█ █▄█ █▀▄ █▄█ █▄█ █░▀█ ░░ █▄█ █▄▄ █▄█ █▄█
MBRjun-Blog 2024 - with Hexo 7 - tk-mbr NYA-
Commit fb88b9e2ff0a8ff6fcd9f78fb07649875fac0302
Build on: runner@Azure-GitHub-Actions (running kernel: 6.5.0-1025-azure)
Date: 2024-10-18 Preset: CI --></body></html>