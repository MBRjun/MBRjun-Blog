<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="MBRjun-Blog"><title>为自己的域名配置 Microsoft 365 邮件服务 - MBRjun-Blog</title><meta name="author" content="MBRjun"><meta name="keywords" content="MBRjun,Linux,服务器,软路由,PVE,原神,maimai,JavaScript,Windows,Microsoft,git,Node.JS,"><link rel="icon" href="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MBRjun","sameAs":["https://github.com/MBRjun","https://twitter.com/MBRjun","mailto:neko@mbr.moe"],"image":"https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"},"articleBody":"使用 Microsoft 365 订阅来搭建自定义域名邮箱，配置好域名邮箱之后，就可以使用自己域名后缀的邮箱来发送邮件了教程同样适用于 Microsoft 365 开发者订阅，也就是 E5  \n\n\n0x01 准备\nMicrosoft 工作或学校账户（需要全局管理员权限）\n一个域名（需要能修改 DNS 记录）\n\n0x02 绑定域名\n先打开 Microsoft 365 后台 - 设置 - 域，点击添加域，输入域名并进行验证按照 Microsoft 后台的说明添加验证记录  \n\n\n主机名\n类型\n值\n优先级\nTTL\n\n\n\n@\nTXT\nMS=msXXXXXXXX\n\n1 天（86400 秒）\n\n\n不同 Microsoft 账号记录值不同，注意修改\n接下来，Microsoft 后台会提示你添加 DNS 记录，我们需要先勾选上 Exchange 和 Exchange Online Protection，然后按照网页说明再添加一波  \n\n\n主机名\n类型\n值\n优先级\nTTL\n\n\n\n@\nMX\nmbr-moe.mail.protection.outlook.com\n0\n1 天（86400 秒）\n\n\n@\nSPF 或 TXT\nv=spf1 include:spf.protection.outlook.com -all\n\n1 天（86400 秒）\n\n\nautodiscover\nCNAME 或 ALIAS\nautodiscover.outlook.com\n\n1 天（86400 秒）\n\n\n不同 Microsoft 账号 MX 记录值不同，注意修改MX 记录用于声明往你的域名发送的邮件应该发给 Microsoft 的服务器，SPF 记录用来证明“以你域名的身份发送的邮件 是你信任的服务器发出的”，最后一条 CNAME 记录是部分电子邮件客户端自动配置时使用的\n\n0x03 为账户绑定邮箱\n打开 Microsoft 365 后台 - 用户 - 活跃用户\n为所有需要使用邮件服务的用户执行下面的操作：\n找到用户名右侧的修改密码（钥匙）按键，右边有三个点，点击那三个点（更多操作）\n点击管理用户名和电子邮件\n主电子邮件地址和用户名 改为你想要的默认收发邮箱，修改完需要重新登录\n如果需要多个收发邮箱，就在下面继续添加 \n\n注 1：其他收发邮箱（默认邮箱以外的绑定邮箱，下文简称 ALIAS）大多数邮件客户端都不能直接发信（发件人列表只有默认邮箱），但 ALIAS 其实是可以 SMTP 的（登录凭据写默认邮箱，From:  指定 ALIAS 即可）；\n\n\n\n注 2：Microsoft 365 组织内人员互相发送邮件，即使你使用 ALIAS，对方收件时会显示发件人为你的默认邮箱，如果你发给组织内成员的 ALIAS，对方邮件客户端会显示自己的主邮箱收到邮件（组织内 你：ALIAS &gt; ALIAS 收件人： 主 &gt; 主）；组织外其他人（指不使用你域名的邮箱，例如 Gmail 用户）向你的 ALIAS 发送邮件，你的客户端会显示是主邮箱收到邮件（组织外 发件人： 对方 &gt; ALIAS 你： 对方 &gt; 主）；你通过 SMTP 使用 ALIAS 给组织外其他人发送邮件，对方客户端会显示你的 ALIAS 发信（组织外 你：ALIAS &gt; 对方 收件人： ALIAS &gt; 对方）；抄送也适用于以上规则，当作收件人就好\n\n\n\n\n\n0x04 配置 DKIM 签名DKIM 是一种验证邮件是否由你发送的方法，它依赖于公钥加密来验证而不仅仅是 IP 地址，所以 DKIM 被认为是比 SPF 更强大的验证形式。配置 DKIM 签名可增强安全性，并防止邮件误判进入垃圾箱  \nSPF 失败后，DKIM 成功，邮件仍能正常传递  \n\n打开 Microsoft 365 Defender - DKIM\n点击你的域名\n点击 创建 DKIM 密钥\n打开上方开关，添加 DNS 记录\n\n\n主机名\n类型\n值\n优先级\nTTL\n\n\n\nselector1._domainkey\nCNAME\nselector1-mbr-moe._domainkey.mbrstudio.onmicrosoft.com\n\n86400\n\n\nselector2._domainkey\nCNAME\nselector2-mbr-moe._domainkey.mbrstudio.onmicrosoft.com\n\n86400\n\n\n记录值包含了组织注册时的邮箱（不可更改）以及你的域名\n\n注 3：组织内人员互相发送邮件，邮件不会被 DKIM 签名\n\n\n\n0x05 配置 DMARCDMARC 也是一种验证邮件的方法，在配置 DMARC 之前，建议先配置好 SPF 和 DKIM  \n配置 DMARC 也需要添加一条 DNS TXT 记录，这个记录你可以使用生成器产生，也可以手写，以下是我的邮箱域名 mbr.moe 的 DMARC 记录  \n\n\n\n主机名\n类型\n值\n优先级\nTTL\n\n\n\n_dmarc\nTXT\nv=DMARC1; p=reject; sp=reject; pct=100; ruf=mailto:dmarc@mbr.moe; rua=mailto:dmarc@mbr.moe; fo=0:1:d:s; rf=afrf; ri=604800; aspf=s; adkim=s\n\n86400\n\n\nDMARC 的参数和注意事项可以看 Cymetrics Tech Blog 的一篇文章： 關於 email security 的大小事 — 設定篇 DKIM、DMARC  \n0x06 收信配置配置好邮箱服务器基本设置后，接下来看看如何收信  \nMicrosoft 365 邮件服务支持了常见的邮件协议，比如 IMAP、POP 和 Exchange ActiveSync(EAS)，也可以使用 Outlook 网页版登录    \nIMAP&#x2F;POP3先来讲一下 IMAP&#x2F;POP3 协议的登陆方法  \n使用 IMAP&#x2F;POP3 登陆时，邮件客户端一般需要你指定服务器和一些其他信息，在你的邮件客户端上填入以下信息即可：\n\n用户名：填写你的默认邮箱\n密码：填写你 Microsoft 账户的密码\n服务器：outlook.office365.com\n端口号：IMAP 993 POP 995\n需要 SSL&#x2F;TLS\nSMTP 配置：详见 SMTP 发信配置\n\n配置好这些信息后保存，就可以正常收信了\nEAS使用 EAS 登录邮箱不会很复杂，登陆时输入用户名和密码验证即可，输入完成后，你的邮件客户端还会打开一个网页，提示你进行授权，而且使用 EAS 登陆是可以使用 2FA 验证的，也许可以提高一些账户安全性  \n\nOutlook 网页版登录这个网址即可 https://outlook.office365.com/mail/  \n0x07 发信配置除了收信，发信也是很重要的，Microsoft 365 支持使用 SMTP、EAS 或者 Outlook 网页版发信  \nSMTPSMTP 配置可能有些复杂，因为 Microsoft 账户默认是不允许发信的，需要先给账号开启 SMTP 功能，还需要关闭安全默认值  \n\n打开 Microsoft 365 后台 - 用户 - 活跃用户\n为所有需要使用邮件服务的用户执行下面的操作：\n点击用户的显示名称\n点击 邮件\n点击 管理电子邮件应用\n勾上 SMTP，保存\n\n\n\n打开 Azure Active Directory Legacy\n点击属性(Properties)-管理安全默认值(Manage security defaults)\n禁用安全默认值，保存\n\n\n\n然后就可以用 SMTP 发信了，SMTP 发信信息填写：\n\n用户名：填写你的默认邮箱\nFrom: 标头：可以是默认邮箱，也可以是 ALIAS\n部分客户端无法指定 From 标头\n\n\n密码：填写你 Microsoft 账户的密码\n服务器：smtp.office365.com\n端口号：587\n需要 STARTTLS\n\nEAS(Sending)EAS 同时支持发信和收信，因此不需要额外配置，配置好收信就可以了  \nEAS 发信，From: 标头默认是你 Microsoft 账户的名字\nOutlook 网页版(sending)同样不需要额外配置，配置好收信就可以了\n0x08 功能设置邮箱的部分功能（例如发件人白名单）需要进入 Outlook 网页版配置，建议用电脑登录然后过一遍全部设置，看看有没有要改的\n0x09 常见错误列举一些常见的配置错误\nE535完整错误是 535 5.7.139 Authentication unsuccessful, SmtpClientAuthentication is disabled for the Tenant. Visit https://aka.ms/smtp_auth_disabled for more information.\n账号没有开启 SMTP，再看一遍发信配置教程  \nE554完整错误是 554 5.2.252 SendAsDenied; neko@mbr.moe not allowed to send as MAILER-DAEMON@PVE.MBR\n没有配置 From: 标头或者配置错误，Linux 容易出现此错误（未配置发件邮箱，直接使用了 &#x72;&#111;&#111;&#116;&#x40;&#108;&#x6f;&#99;&#x61;&#x6c;&#x68;&#111;&#x73;&#116;&#46;&#108;&#x6f;&#x63;&#97;&#x6c;&#x64;&#111;&#109;&#97;&#x69;&#x6e; 这样的邮箱）配置发件人即可，Linux Postfix 可以按下面方法配置：  \n/etc/postfix/main.cf\n1smtp_header_checks = pcre:/etc/postfix/headers\n\n/etc/postfix/headers\n1/^From:.*/ REPLACE From: MBRjun Device Notifications &lt;noreply-devices@mbr.moe&gt;\n然后在 /etc/postfix/headers 里面设置发件人信息就好，配置完成后，所有发出的邮件 From: 都会改写为你配置的邮箱  \n0x0A 测试配置好之后就可以测试收发了：  \n正常发送邮件\n","dateCreated":"2023-03-30T19:33:37+08:00","dateModified":"2023-04-05T15:26:17+08:00","datePublished":"2023-03-30T19:33:37+08:00","description":"使用 Microsoft 365 订阅来搭建自定义域名邮箱，配置好域名邮箱之后，就可以使用自己域名后缀的邮箱来发送邮件了教程同样适用于 Microsoft 365 开发者订阅，也就是 E5  ","headline":"为自己的域名配置 Microsoft 365 邮件服务","image":["https://cos.mbrjun.cn/IMGS/2023/04/05/d7c30411-b252-46f5-8a18-0074432ff16c.webp"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.mbrjun.cn/archives/476/"},"publisher":{"@type":"Organization","name":"MBRjun","sameAs":["https://github.com/MBRjun","https://twitter.com/MBRjun","mailto:neko@mbr.moe"],"image":"https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg","logo":{"@type":"ImageObject","url":"https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"}},"url":"https://www.mbrjun.cn/archives/476/","keywords":"Office, 域名, Office365, 邮箱","thumbnailUrl":"https://cos.mbrjun.cn/IMGS/2023/04/05/d7c30411-b252-46f5-8a18-0074432ff16c.webp"}</script><meta name="description" content="使用 Microsoft 365 订阅来搭建自定义域名邮箱，配置好域名邮箱之后，就可以使用自己域名后缀的邮箱来发送邮件了教程同样适用于 Microsoft 365 开发者订阅，也就是 E5"><meta property="og:type" content="blog"><meta property="og:title" content="为自己的域名配置 Microsoft 365 邮件服务"><meta property="og:url" content="https://www.mbrjun.cn/archives/476/index.html"><meta property="og:site_name" content="MBRjun-Blog"><meta property="og:description" content="使用 Microsoft 365 订阅来搭建自定义域名邮箱，配置好域名邮箱之后，就可以使用自己域名后缀的邮箱来发送邮件了教程同样适用于 Microsoft 365 开发者订阅，也就是 E5"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2023/03/31/9868eead-68c7-4759-84d6-548509017236.webp"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2023/04/03/28f93b4c-97e7-4309-acc4-fd0d2e0e3377.webp"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2023/04/05/ecdd7f91-fbbf-4da1-99b0-9e89b7007a51.webp"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2023/04/05/de82ad2b-ce01-47c1-928b-7a4c49eebee1.webp"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2023/04/05/f5ee828c-2523-4698-8d16-066fd20a7f80.webp"><meta property="article:published_time" content="2023-03-30T11:33:37.000Z"><meta property="article:modified_time" content="2023-04-05T07:26:17.000Z"><meta property="article:author" content="MBRjun"><meta property="article:tag" content="Office"><meta property="article:tag" content="域名"><meta property="article:tag" content="Office365"><meta property="article:tag" content="邮箱"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cos.mbrjun.cn/IMGS/2023/03/31/9868eead-68c7-4759-84d6-548509017236.webp"><meta name="twitter:creator" content="@MBRjun"><meta property="og:image" content="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg"><meta property="og:image" content="https://cos.mbrjun.cn/IMGS/2023/04/05/d7c30411-b252-46f5-8a18-0074432ff16c.webp"><meta class="swiftype" name="image" data-type="enum" content="https://cos.mbrjun.cn/IMGS/2023/04/05/d7c30411-b252-46f5-8a18-0074432ff16c.webp"><!--STYLES--><link rel="stylesheet" href="/assets/css/style.min.css?v=05949bc0ebcb7167c296a188a6fd7c4dc938b707"><!--STYLES END--><!--SCRIPTS--><script async="" defer="" src="/assets/js/script.min.js?v=05949bc0ebcb7167c296a188a6fd7c4dc938b707"></script><!--SCRIPTS END--><!--PRELOAD--><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="//github.githubassets.com"><link rel="dns-prefetch" href="//avatars.githubusercontent.com"><link rel="preconnect" href="https://cos.mbrjun.cn"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/GoogleSansDisplay-BR.woff2"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/GoogleSansDisplay-LR.woff2"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/fa-solid-900.woff2"><link rel="preload" as="font" crossorigin="anonymous" type="font/woff2" href="/assets/fonts/fa-brands-400.woff2"><!--PRELOAD END--><script>"use strict";var scripts=["/assets/js/webp-polyfill.min.js?v=2.0.1"];function parallelLoadScripts(e,t){"object"!=typeof e&&(e=[e]);for(var n=document.getElementsByTagName("head")[0]||document.documentElement,o=[],l=0,i=0;i<e.length;i++)o[i]=document.createElement("script"),o[i].setAttribute("type","text/javascript"),o[i].onload=o[i].onreadystatechange=function(){l++,this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this),l===e.length&&"function"==typeof t&&t()},o[i].setAttribute("src",e[i]),n.appendChild(o[i])}"ActiveXObject"in window&&parallelLoadScripts(scripts,function(){console.log("[hexo-webp-polyfill] polyfilling document"),(new webpHero.WebpMachine).polyfillDocument()});</script></head><body><div id="blog"><!-- Define author's picture --><header id="header" data-behavior="2"><i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i><div class="header-title"><a class="header-title-link" href="/" aria-label="">MBRjun-Blog</a></div><a class="header-right-picture" href="/about" aria-label="打开链接: /about"><img class="header-picture" src="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg" alt="作者的图片"></a></header><!-- Define author's picture --><nav id="sidebar" data-behavior="2"><div class="sidebar-container"><div class="sidebar-profile"><a href="/#about" aria-label="阅读有关作者的更多信息"><img class="sidebar-profile-picture" src="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg" alt="作者的图片"></a><h4 class="sidebar-profile-name">MBRjun</h4><h5 class="sidebar-profile-bio"><p>我们生活在大地上，但我们的梦想超越天空</p></h5></div><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/" rel="noopener" title="首页"><i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i> <span class="sidebar-button-desc">首页</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-categories" rel="noopener" title="分类"><i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i> <span class="sidebar-button-desc">分类</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-tags" rel="noopener" title="标签"><i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i> <span class="sidebar-button-desc">标签</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/all-archives" rel="noopener" title="归档"><i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i> <span class="sidebar-button-desc">归档</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="/links" rel="noopener" title="友情链接"><i class="sidebar-button-icon fa fa-link" aria-hidden="true"></i> <span class="sidebar-button-desc">友情链接</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://www.travellings.cn/go.html" target="_blank" rel="noopener" title="开往"><i class="sidebar-button-icon fa fa-paper-plane" aria-hidden="true"></i> <span class="sidebar-button-desc">开往</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="https://github.com/MBRjun" target="_blank" rel="noopener" title="GitHub"><i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i> <span class="sidebar-button-desc">GitHub</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="https://twitter.com/MBRjun" target="_blank" rel="noopener" title="Twitter"><i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i> <span class="sidebar-button-desc">Twitter</span></a></li><li class="sidebar-button"><a class="sidebar-button-link" href="mailto:neko@mbr.moe" target="_blank" rel="noopener" title="邮箱"><i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i> <span class="sidebar-button-desc">邮箱</span></a></li></ul><ul class="sidebar-buttons"><li class="sidebar-button"><a class="sidebar-button-link" href="/atom.xml" rel="noopener" title="RSS"><i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i> <span class="sidebar-button-desc">RSS</span></a></li></ul></div></nav><div id="main" data-behavior="2" class="hasCoverMetaIn"><article class="post"><div class="post-header main-content-wrap text-left"><h1 class="post-title">为自己的域名配置 Microsoft 365 邮件服务</h1><div class="post-meta"><time datetime="2023-03-30T19:33:37+08:00">2023 年 3 月 30 日 </time><span>发布在 </span><a class="category-link" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></div></div><div class="post-content markdown"><div class="main-content-wrap"><p>使用 Microsoft 365 订阅来搭建自定义域名邮箱，配置好域名邮箱之后，就可以使用自己域名后缀的邮箱来发送邮件了<br>教程同样适用于 Microsoft 365 开发者订阅，也就是 E5</p><span id="more"></span><hr><h2 id="0x01-准备"><a href="#0x01-准备" class="headerlink" title="0x01 准备"></a>0x01 准备</h2><ul><li>Microsoft 工作或学校账户（需要全局管理员权限）</li><li>一个域名（需要能修改 DNS 记录）</li></ul><h2 id="0x02-绑定域名"><a href="#0x02-绑定域名" class="headerlink" title="0x02 绑定域名"></a>0x02 绑定域名</h2><ul><li>先打开 <a target="_blank" rel="noopener" href="https://admin.microsoft.com/Adminportal/Home?source=applauncher#/Domains">Microsoft 365 后台 - 设置 - 域</a>，点击<code>添加域</code>，输入域名并进行验证<br>按照 Microsoft 后台的说明添加验证记录<table><thead><tr><th>主机名</th><th>类型</th><th>值</th><th>优先级</th><th>TTL</th></tr></thead><tbody><tr><td><code>@</code></td><td>TXT</td><td><code>MS=msXXXXXXXX</code></td><td></td><td><code>1</code> 天（<code>86400</code> 秒）</td></tr></tbody></table>不同 Microsoft 账号记录值不同，注意修改</li><li>接下来，Microsoft 后台会提示你添加 DNS 记录，我们需要先勾选上 <strong>Exchange 和 Exchange Online Protection</strong>，然后按照网页说明再添加一波<table><thead><tr><th>主机名</th><th>类型</th><th>值</th><th>优先级</th><th>TTL</th></tr></thead><tbody><tr><td><code>@</code></td><td>MX</td><td><code>mbr-moe.mail.protection.outlook.com</code></td><td><code>0</code></td><td><code>1</code> 天（<code>86400</code> 秒）</td></tr><tr><td><code>@</code></td><td>SPF 或 TXT</td><td><code>v=spf1 include:spf.protection.outlook.com -all</code></td><td></td><td><code>1</code> 天（<code>86400</code> 秒）</td></tr><tr><td><code>autodiscover</code></td><td>CNAME 或 ALIAS</td><td><code>autodiscover.outlook.com</code></td><td></td><td><code>1</code> 天（<code>86400</code> 秒）</td></tr></tbody></table>不同 Microsoft 账号 MX 记录值不同，注意修改<br>MX 记录用于声明往你的域名发送的邮件应该发给 Microsoft 的服务器，SPF 记录用来证明“以你域名的身份发送的邮件 是你信任的服务器发出的”，最后一条 CNAME 记录是部分电子邮件客户端自动配置时使用的</li></ul><h2 id="0x03-为账户绑定邮箱"><a href="#0x03-为账户绑定邮箱" class="headerlink" title="0x03 为账户绑定邮箱"></a>0x03 为账户绑定邮箱</h2><ul><li>打开 <a target="_blank" rel="noopener" href="https://admin.microsoft.com/Adminportal/Home?source=applauncher#/users">Microsoft 365 后台 - 用户 - 活跃用户</a></li><li>为所有需要使用邮件服务的用户执行下面的操作：<ul><li>找到用户名右侧的修改密码（钥匙）按键，右边有三个点，点击那三个点（<code>更多操作</code>）</li><li>点击<code>管理用户名和电子邮件</code></li><li><code>主电子邮件地址和用户名</code> 改为你想要的默认收发邮箱，修改完需要重新登录</li><li>如果需要多个收发邮箱，就在下面继续添加 <img src="https://cos.mbrjun.cn/IMGS/2023/03/31/9868eead-68c7-4759-84d6-548509017236.webp"></li><li><blockquote><p>注 1：其他收发邮箱（默认邮箱以外的绑定邮箱，下文简称 ALIAS）大多数邮件客户端都不能直接发信（发件人列表只有默认邮箱），但 ALIAS 其实是可以 SMTP 的（登录凭据写默认邮箱，<code>From:</code> 指定 ALIAS 即可）；</p></blockquote></li><li><blockquote><p>注 2：Microsoft 365 组织内人员互相发送邮件，即使你使用 ALIAS，对方收件时会显示发件人为你的默认邮箱，如果你发给组织内成员的 ALIAS，对方邮件客户端会显示自己的主邮箱收到邮件（组织内 你：ALIAS &gt; ALIAS 收件人： 主 &gt; 主）；组织外其他人（指不使用你域名的邮箱，例如 Gmail 用户）向你的 ALIAS 发送邮件，你的客户端会显示是主邮箱收到邮件（组织外 发件人： 对方 &gt; ALIAS 你： 对方 &gt; 主）；你通过 SMTP 使用 ALIAS 给组织外其他人发送邮件，对方客户端会显示你的 ALIAS 发信（组织外 你：ALIAS &gt; 对方 收件人： ALIAS &gt; 对方）；抄送也适用于以上规则，当作收件人就好</p></blockquote></li></ul></li></ul><h2 id="0x04-配置-DKIM-签名"><a href="#0x04-配置-DKIM-签名" class="headerlink" title="0x04 配置 DKIM 签名"></a>0x04 配置 DKIM 签名</h2><p>DKIM 是一种验证邮件是否由你发送的方法，它依赖于公钥加密来验证而不仅仅是 IP 地址，所以 DKIM 被认为是比 SPF 更强大的验证形式。配置 DKIM 签名可增强安全性，并防止邮件<strong>误判</strong>进入垃圾箱</p><p><img src="https://cos.mbrjun.cn/IMGS/2023/04/03/28f93b4c-97e7-4309-acc4-fd0d2e0e3377.webp" alt="DKIM"><br>SPF 失败后，DKIM 成功，邮件仍能正常传递</p><ul><li>打开 <a target="_blank" rel="noopener" href="https://security.microsoft.com/dkimv2">Microsoft 365 Defender - DKIM</a></li><li>点击<em>你的域名</em></li><li>点击 <code>创建 DKIM 密钥</code></li><li>打开上方开关，添加 DNS 记录<table><thead><tr><th>主机名</th><th>类型</th><th>值</th><th>优先级</th><th>TTL</th></tr></thead><tbody><tr><td><code>selector1._domainkey</code></td><td>CNAME</td><td>selector1-mbr-moe._domainkey.mbrstudio.onmicrosoft.com</td><td></td><td>86400</td></tr><tr><td><code>selector2._domainkey</code></td><td>CNAME</td><td>selector2-mbr-moe._domainkey.mbrstudio.onmicrosoft.com</td><td></td><td>86400</td></tr></tbody></table>记录值包含了组织注册时的邮箱（不可更改）以及你的域名</li><li><blockquote><p>注 3：组织内人员互相发送邮件，邮件不会被 DKIM 签名</p></blockquote></li></ul><h2 id="0x05-配置-DMARC"><a href="#0x05-配置-DMARC" class="headerlink" title="0x05 配置 DMARC"></a>0x05 配置 DMARC</h2><p>DMARC 也是一种验证邮件的方法，在配置 DMARC 之前，建议先配置好 SPF 和 DKIM</p><p>配置 DMARC 也需要添加一条 DNS TXT 记录，这个记录你可以使用生成器产生，也可以手写，以下是我的邮箱域名 mbr.moe 的 DMARC 记录</p><table><thead><tr><th>主机名</th><th>类型</th><th>值</th><th>优先级</th><th>TTL</th></tr></thead><tbody><tr><td><code>_dmarc</code></td><td>TXT</td><td><code>v=DMARC1; p=reject; sp=reject; pct=100; ruf=mailto:dmarc@mbr.moe; rua=mailto:dmarc@mbr.moe; fo=0:1:d:s; rf=afrf; ri=604800; aspf=s; adkim=s</code></td><td></td><td>86400</td></tr></tbody></table><p>DMARC 的参数和注意事项可以看 <strong>Cymetrics Tech Blog</strong> 的一篇文章： <a target="_blank" rel="noopener" href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-dkimdmarc/#dmarc">關於 email security 的大小事 — 設定篇 DKIM、DMARC</a></p><h2 id="0x06-收信配置"><a href="#0x06-收信配置" class="headerlink" title="0x06 收信配置"></a>0x06 收信配置</h2><p>配置好邮箱服务器基本设置后，接下来看看如何收信</p><p>Microsoft 365 邮件服务支持了常见的邮件协议，比如 IMAP、POP 和 <strong>E</strong>xchange <strong>A</strong>ctive<strong>S</strong>ync(EAS)，也可以使用 Outlook 网页版登录</p><h3 id="IMAP-POP3"><a href="#IMAP-POP3" class="headerlink" title="IMAP/POP3"></a>IMAP/POP3</h3><p>先来讲一下 IMAP/POP3 协议的登陆方法</p><p>使用 IMAP/POP3 登陆时，邮件客户端一般需要你指定服务器和一些其他信息，在你的邮件客户端上填入以下信息即可：</p><ul><li>用户名：<em>填写你的默认邮箱</em></li><li>密码：<em>填写你 Microsoft 账户的密码</em></li><li>服务器：<code>outlook.office365.com</code></li><li>端口号：IMAP <code>993</code> POP <code>995</code></li><li>需要 SSL/TLS</li><li>SMTP 配置：详见 <a href="#smtp">SMTP 发信配置</a></li></ul><p>配置好这些信息后保存，就可以正常收信了</p><h3 id="EAS"><a href="#EAS" class="headerlink" title="EAS"></a>EAS</h3><p>使用 EAS 登录邮箱不会很复杂，登陆时输入用户名和密码验证即可，输入完成后，你的邮件客户端还会打开一个网页，提示你进行授权，而且使用 EAS 登陆是可以使用 2FA 验证的，也许可以提高一些账户安全性</p><p><img src="https://cos.mbrjun.cn/IMGS/2023/04/05/ecdd7f91-fbbf-4da1-99b0-9e89b7007a51.webp"></p><h3 id="Outlook-网页版"><a href="#Outlook-网页版" class="headerlink" title="Outlook 网页版"></a>Outlook 网页版</h3><p>登录这个网址即可 <a target="_blank" rel="noopener" href="https://outlook.office365.com/mail/">https://outlook.office365.com/mail/</a></p><h2 id="0x07-发信配置"><a href="#0x07-发信配置" class="headerlink" title="0x07 发信配置"></a>0x07 发信配置</h2><p>除了收信，发信也是很重要的，Microsoft 365 支持使用 SMTP、EAS 或者 Outlook 网页版发信</p><h3 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h3><p>SMTP 配置可能有些复杂，因为 Microsoft 账户默认是不允许发信的，需要先给账号开启 SMTP 功能，还需要关闭<em>安全默认值</em></p><ul><li>打开 <a target="_blank" rel="noopener" href="https://admin.microsoft.com/Adminportal/Home?source=applauncher#/users">Microsoft 365 后台 - 用户 - 活跃用户</a></li><li>为所有需要使用邮件服务的用户执行下面的操作：<ul><li>点击用户的显示名称</li><li>点击 <code>邮件</code></li><li>点击 <code>管理电子邮件应用</code></li><li>勾上 <code>SMTP</code>，保存</li><li><img src="https://cos.mbrjun.cn/IMGS/2023/04/05/de82ad2b-ce01-47c1-928b-7a4c49eebee1.webp"></li></ul></li><li>打开 <a target="_blank" rel="noopener" href="https://entra.microsoft.com/#view/Microsoft_AAD_IAM/TenantOverview.ReactView?Microsoft_AAD_IAM_legacyAADRedirect=true">Azure Active Directory Legacy</a><ul><li>点击<code>属性</code>(<code>Properties</code>)-<code>管理安全默认值</code>(<code>Manage security defaults</code>)</li><li>禁用安全默认值，保存</li></ul></li></ul><p>然后就可以用 SMTP 发信了，SMTP 发信信息填写：</p><ul><li>用户名：<em>填写你的默认邮箱</em></li><li><code>From:</code> 标头：<em>可以是默认邮箱，也可以是 ALIAS</em><ul><li>部分客户端无法指定 From 标头</li></ul></li><li>密码：<em>填写你 Microsoft 账户的密码</em></li><li>服务器：<code>smtp.office365.com</code></li><li>端口号：<code>587</code></li><li>需要 STARTTLS</li></ul><h3 id="EAS-Sending"><a href="#EAS-Sending" class="headerlink" title="EAS(Sending)"></a>EAS(Sending)</h3><p>EAS 同时支持发信和收信，因此不需要额外配置，配置好<a href="#eas">收信</a>就可以了</p><p>EAS 发信，<code>From:</code>标头默认是你 Microsoft 账户的名字</p><h3 id="Outlook-网页版-sending"><a href="#Outlook-网页版-sending" class="headerlink" title="Outlook 网页版(sending)"></a>Outlook 网页版(sending)</h3><p>同样不需要额外配置，配置好<a href="#outlook-%E7%BD%91%E9%A1%B5%E7%89%88">收信</a>就可以了</p><h2 id="0x08-功能设置"><a href="#0x08-功能设置" class="headerlink" title="0x08 功能设置"></a>0x08 功能设置</h2><p>邮箱的部分功能（例如发件人白名单）需要进入 <a href="#outlook-%E7%BD%91%E9%A1%B5%E7%89%88">Outlook 网页版</a>配置，建议用电脑登录然后过一遍全部设置，看看有没有要改的</p><h2 id="0x09-常见错误"><a href="#0x09-常见错误" class="headerlink" title="0x09 常见错误"></a>0x09 常见错误</h2><p>列举一些常见的配置错误</p><h3 id="E535"><a href="#E535" class="headerlink" title="E535"></a>E535</h3><p>完整错误是 <code>535 5.7.139 Authentication unsuccessful, SmtpClientAuthentication is disabled for the Tenant. Visit https://aka.ms/smtp_auth_disabled for more information.</code></p><p>账号没有开启 SMTP，再看一遍<a href="#smtp">发信配置教程</a></p><h3 id="E554"><a href="#E554" class="headerlink" title="E554"></a>E554</h3><p>完整错误是 <code>554 5.2.252 SendAsDenied; neko@mbr.moe not allowed to send as MAILER-DAEMON@PVE.MBR</code></p><p>没有配置 <code>From:</code> 标头或者配置错误，Linux 容易出现此错误（未配置发件邮箱，直接使用了 <a href="mailto:root@localhost.localdomain">root@localhost.localdomain</a> 这样的邮箱）<br>配置发件人即可，Linux Postfix 可以按下面方法配置：</p><p><code>/etc/postfix/main.cf</code></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">smtp_header_checks = pcre:/etc/postfix/headers<br></code></pre></td></tr></tbody></table></figure><p><code>/etc/postfix/headers</code></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/^From:.*/ REPLACE From: MBRjun Device Notifications &lt;noreply-devices@mbr.moe&gt;<br></code></pre></td></tr></tbody></table></figure><p>然后在 <code>/etc/postfix/headers</code> 里面设置发件人信息就好，配置完成后，所有发出的邮件 <code>From:</code> 都会改写为你配置的邮箱</p><h2 id="0x0A-测试"><a href="#0x0A-测试" class="headerlink" title="0x0A 测试"></a>0x0A 测试</h2><p>配置好之后就可以测试收发了：</p><p><img src="https://cos.mbrjun.cn/IMGS/2023/04/05/f5ee828c-2523-4698-8d16-066fd20a7f80.webp"><br>正常发送邮件</p></div></div><div id="post-footer" class="post-footer main-content-wrap"><div class="post-footer-tags"><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small t-none-link" href="/tags/Office/" rel="tag">Office</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Office365/" rel="tag">Office365</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E5%9F%9F%E5%90%8D/" rel="tag">域名</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/%E9%82%AE%E7%AE%B1/" rel="tag">邮箱</a></div><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/477/" data-tooltip="Microsoft 365 E5 开发人员订阅大面积封号" aria-label="上一篇: Microsoft 365 E5 开发人员订阅大面积封号"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/475/" data-tooltip="npm 抑制 deprecated 警告" aria-label="下一篇: npm 抑制 deprecated 警告"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.mbrjun.cn/archives/476/" title="分享到 Twitter" aria-label="分享到 Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://www.mbrjun.cn/archives/476/" title="分享到 Weibo" aria-label="分享到 Weibo"><i class="fab fa-weibo" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.mbrjun.cn/archives/476/&amp;title=为自己的域名配置 Microsoft 365 邮件服务" title="分享到 QQ" aria-label="分享到 QQ"><i class="fab fa-qq" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.mbrjun.cn/archives/476/" title="分享到 Qzone" aria-label="分享到 Qzone"><i class="fa fa-star" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div><script src="https://giscus.mbrjun.cn/client.js" data-repo="MBRjun/MBRjun-Blog" data-repo-id="R_kgDOIbI33Q" data-category="Blog" data-category-id="DIC_kwDOIbI33c4CTUTq" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light_tritanopia" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async=""></script></div></article><footer id="footer" class="main-content-wrap"><span class="copyrights"><a target="_blank" rel="noopener" href="https://github.com/MBRjun/MBRjun-Blog">GitHub 源代码</a> - <a target="_blank" rel="noopener" href="https://github.com/MBRjun/MBRjun-Blog/blob/main/LICENSE">LICENSE(CC BY-SA 3)</a><br></span><span class="text-small"><a target="_blank" href="https://beian.miit.gov.cn" rel="nofollow noopener">闽ICP备2024060656号-1</a> - <a target="_blank" href="http://www.beian.gov.cn" rel="nofollow noopener">津公网安备12010102001086号</a><br></span><span class="copyrights">Copyrights © 2024 MBRjun. All Rights Reserved.</span></footer><script async="" defer="" data-website-id="d1e9e8b4-ed73-416a-b8e7-ae518e698da6" src="https://delightful.mbrjun.cn/delightful.js?v=2.2.0-1"></script></div><div id="bottom-bar" class="post-bottom-bar" data-behavior="2"><div class="post-actions-wrap"><nav><ul class="post-actions post-action-nav"><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/477/" data-tooltip="Microsoft 365 E5 开发人员订阅大面积封号" aria-label="上一篇: Microsoft 365 E5 开发人员订阅大面积封号"><i class="fa fa-angle-left" aria-hidden="true"></i> <span class="hide-xs hide-sm text-small icon-ml">上一篇</span></a></li><li class="post-action"><a class="post-action-btn btn btn--default tooltip--top" href="/archives/475/" data-tooltip="npm 抑制 deprecated 警告" aria-label="下一篇: npm 抑制 deprecated 警告"><span class="hide-xs hide-sm text-small icon-mr">下一篇</span> <i class="fa fa-angle-right" aria-hidden="true"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen"><i class="fa fa-share-alt" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.mbrjun.cn/archives/476/" title="分享到 Twitter" aria-label="分享到 Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://www.mbrjun.cn/archives/476/" title="分享到 Weibo" aria-label="分享到 Weibo"><i class="fab fa-weibo" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.mbrjun.cn/archives/476/&amp;title=为自己的域名配置 Microsoft 365 邮件服务" title="分享到 QQ" aria-label="分享到 QQ"><i class="fab fa-qq" aria-hidden="true"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.mbrjun.cn/archives/476/" title="分享到 Qzone" aria-label="分享到 Qzone"><i class="fa fa-star" aria-hidden="true"></i></a></li><li class="post-action"><a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben"><i class="fa fa-list" aria-hidden="true"></i></a></li></ul></div></div><div id="share-options-bar" class="share-options-bar" data-behavior="2"><i id="btn-close-shareoptions" class="fa fa-times"></i><ul class="share-options"><li class="share-option"><a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://www.mbrjun.cn/archives/476/" aria-label="分享到 Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://www.mbrjun.cn/archives/476/" aria-label="分享到 Weibo"><i class="fab fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.mbrjun.cn/archives/476/&amp;title=为自己的域名配置 Microsoft 365 邮件服务" aria-label="分享到 QQ"><i class="fab fa-qq" aria-hidden="true"></i><span>分享到 QQ</span></a></li><li class="share-option"><a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.mbrjun.cn/archives/476/" aria-label="分享到 Qzone"><i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span></a></li></ul></div></div><div id="about"><div id="about-card"><div id="about-btn-close"><i class="fa fa-times"></i></div><img id="about-card-picture" src="https://cos.mbrjun.cn/PICS/LG4v3avatar144px.jpg" alt="作者的图片"><h4 id="about-card-name">MBRjun</h4><div id="about-card-bio"><p>我们生活在大地上，但我们的梦想超越天空</p></div><div id="about-card-job"><i class="fa fa-briefcase"></i><br><p>学生</p></div><div id="about-card-location"><i class="fa fa-map-marker-alt"></i><br>地球</div></div></div><div id="cover" style="background-image:url('https://cos.mbrjun.cn/IMGS/2023/03/23/4419f34e-9353-4b44-a6dd-ebb1db958fc5.webp');"></div><!-- 
█▀▄▀█ █▄▄ █▀█ ░░█ █░█ █▄░█ ▄▄ █▄▄ █░░ █▀█ █▀▀
█░▀░█ █▄█ █▀▄ █▄█ █▄█ █░▀█ ░░ █▄█ █▄▄ █▄█ █▄█
MBRjun-Blog 2024 - with Hexo 7 - tk-mbr NYA-
Commit 05949bc0ebcb7167c296a188a6fd7c4dc938b707
Build on: runner@Azure-GitHub-Actions (running kernel: 6.8.0-1014-azure)
Date: 2024-09-27 Preset: CI --></body></html>